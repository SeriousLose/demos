<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
</html>
<!-- <script>
  (function () {
    var open = window.XMLHttpRequest.prototype.open;
    var send = window.XMLHttpRequest.prototype.send;
    var onReadyStateChange;
    function openReplacement(method, url, async, user, password) {
      // some code
      return open.apply(this, arguments);
    }

    function sendReplacement(data) {
      // some code
      if (this.onreadystatechange) this._onreadystatechange = this.onreadystatechange;
      this.onreadystatechange = onReadyStateChangeReplacement;
      return send.apply(this, arguments);
    }

    function onReadyStateChangeReplacement() {
      // some code
      if (this._onreadystatechange) return this._onreadystatechange.apply(this, arguments);
    }
    window.XMLHttpRequest.prototype.open = openReplacement;
    window.XMLHttpRequest.prototype.send = sendReplacement;
  })();
</script> -->

<!-- <script>
  (function () {
    function ajaxEventTrigger(event) {
      var ajaxEvent = new CustomEvent(event, { detail: this });
      window.dispatchEvent(ajaxEvent);
    }

    var oldXHR = window.XMLHttpRequest;

    function newXHR() {
      var realXHR = new oldXHR();

      realXHR.addEventListener(
        'abort',
        function () {
          ajaxEventTrigger.call(this, 'ajaxAbort');
        },
        false
      );

      realXHR.addEventListener(
        'error',
        function () {
          ajaxEventTrigger.call(this, 'ajaxError');
        },
        false
      );

      realXHR.addEventListener(
        'load',
        function () {
          ajaxEventTrigger.call(this, 'ajaxLoad');
        },
        false
      );

      realXHR.addEventListener(
        'loadstart',
        function () {
          ajaxEventTrigger.call(this, 'ajaxLoadStart');
        },
        false
      );

      realXHR.addEventListener(
        'progress',
        function () {
          ajaxEventTrigger.call(this, 'ajaxProgress');
        },
        false
      );

      realXHR.addEventListener(
        'timeout',
        function () {
          ajaxEventTrigger.call(this, 'ajaxTimeout');
        },
        false
      );

      realXHR.addEventListener(
        'loadend',
        function () {
          ajaxEventTrigger.call(this, 'ajaxLoadEnd');
        },
        false
      );

      realXHR.addEventListener(
        'readystatechange',
        function () {
          ajaxEventTrigger.call(this, 'ajaxReadyStateChange');
        },
        false
      );

      return realXHR;
    }

    window.XMLHttpRequest = newXHR;
  })();

  var xhr = new XMLHttpRequest();

  window.addEventListener('ajaxReadyStateChange', function (e) {
    console.log(e.detail); // XMLHttpRequest Object
  });
  window.addEventListener('ajaxAbort', function (e) {
    console.log(e.detail.responseText); // XHR 返回的内容
  });

  xhr.open('GET', 'info.json');
  xhr.send();
</script> -->

<script>
  (function () {
    if (typeof window.CustomEvent === 'function') return false;
    function CustomEvent(event, params) {
      params = params || { bubbles: false, cancelable: false, detail: undefined };
      var evt = document.createEvent('CustomEvent');
      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
      return evt;
    }
    CustomEvent.prototype = window.Event.prototype;
    window.CustomEvent = CustomEvent;
  })();

  (function () {
    function ajaxEventTrigger(event) {
      var ajaxEvent = new CustomEvent(event, { detail: this });
      window.dispatchEvent(ajaxEvent);
    }

    var oldXHR = window.XMLHttpRequest;

    function newXHR() {
      var realXHR = new oldXHR();

      realXHR.addEventListener(
        'abort',
        function () {
          console.log('ajaxAbort');
          ajaxEventTrigger.call(this, 'ajaxAbort');
        },
        false
      );

      realXHR.addEventListener(
        'error',
        function () {
          console.log('ajaxError');
          ajaxEventTrigger.call(this, 'ajaxError');
        },
        false
      );

      realXHR.addEventListener(
        'load',
        function () {
          console.log('ajaxLoad');
          ajaxEventTrigger.call(this, 'ajaxLoad');
        },
        false
      );

      realXHR.addEventListener(
        'loadstart',
        function () {
          console.log('ajaxLoadStart');
          ajaxEventTrigger.call(this, 'ajaxLoadStart');
        },
        false
      );

      realXHR.addEventListener(
        'progress',
        function () {
          console.log('ajaxProgress');
          ajaxEventTrigger.call(this, 'ajaxProgress');
        },
        false
      );

      realXHR.addEventListener(
        'timeout',
        function () {
          console.log('ajaxTimeout');
          ajaxEventTrigger.call(this, 'ajaxTimeout');
        },
        false
      );

      realXHR.addEventListener(
        'loadend',
        function () {
          console.log('ajaxLoadEnd');
          ajaxEventTrigger.call(this, 'ajaxLoadEnd');
        },
        false
      );

      realXHR.addEventListener(
        'readystatechange',
        function () {
          console.log('ajaxReadyStateChange');
          ajaxEventTrigger.call(this, 'ajaxReadyStateChange');
        },
        false
      );

      return realXHR;
    }
    window.XMLHttpRequest = newXHR;
  })();
</script>
